<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Photo Upload - New Student Information</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { border: 1px solid #ccc; margin: 20px 0; padding: 15px; }
        .log { background: #f5f5f5; padding: 10px; font-family: monospace; font-size: 12px; white-space: pre-wrap; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input[type="file"] { margin: 10px 0; }
        #result img { max-width: 200px; margin: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>ğŸ” New Student Information - Photo Upload Test</h1>
    
    <div class="test-section">
        <h2>ğŸ“ Step 1: Select a Photo</h2>
        <input type="file" id="fileInput" accept="image/*">
        <button onclick="testStep1()">Test File Selection</button>
    </div>

    <div class="test-section">
        <h2>ğŸ’¾ Step 2: Test localStorage Storage</h2>
        <button onclick="testStep2()">Save to localStorage</button>
        <button onclick="testStep3()">Load from localStorage</button>
    </div>

    <div class="test-section">
        <h2>â˜ï¸ Step 3: Test Cloudinary Upload</h2>
        <button onclick="testStep4()">Upload to Cloudinary</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š Results</h2>
        <div id="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ Debug Log</h2>
        <div id="log" class="log"></div>
    </div>

    <script>
        let selectedFile = null;
        let reconstructedFile = null;

        function log(message) {
            const logElement = document.getElementById('log');
            logElement.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }

        function testStep1() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                log('âŒ No file selected');
                return;
            }

            selectedFile = fileInput.files[0];
            log('âœ… File selected:');
            log(`   Name: ${selectedFile.name}`);
            log(`   Size: ${selectedFile.size}`);
            log(`   Type: ${selectedFile.type}`);

            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                const result = document.getElementById('result');
                result.innerHTML = \`<h3>Original File Preview:</h3><img src="\${e.target.result}" alt="Original">\`;
            };
            reader.readAsDataURL(selectedFile);
        }

        function testStep2() {
            if (!selectedFile) {
                log('âŒ No file selected for localStorage test');
                return;
            }

            log('ğŸ’¾ Converting file to base64 for localStorage...');
            const reader = new FileReader();
            reader.onload = () => {
                const base64Data = reader.result;
                log(\`âœ… Base64 conversion successful, length: \${base64Data.length}\`);

                const fileDataForStorage = {
                    name: selectedFile.name,
                    type: selectedFile.type,
                    size: selectedFile.size,
                    data: base64Data
                };

                localStorage.setItem('testFileData', JSON.stringify(fileDataForStorage));
                log('âœ… File data saved to localStorage');
            };
            reader.readAsDataURL(selectedFile);
        }

        async function testStep3() {
            log('ğŸ”„ Attempting to reconstruct file from localStorage...');
            
            const fileDataStr = localStorage.getItem('testFileData');
            if (!fileDataStr) {
                log('âŒ No file data found in localStorage');
                return;
            }

            try {
                const parsedFileData = JSON.parse(fileDataStr);
                log('ğŸ“„ Found file data in localStorage:');
                log(\`   Name: \${parsedFileData.name}\`);
                log(\`   Type: \${parsedFileData.type}\`);
                log(\`   Size: \${parsedFileData.size}\`);

                // Convert base64 back to File object
                const response = await fetch(parsedFileData.data);
                const blob = await response.blob();
                reconstructedFile = new File([blob], parsedFileData.name, {
                    type: parsedFileData.type,
                    lastModified: Date.now()
                });

                log('âœ… File object reconstructed:');
                log(\`   Name: \${reconstructedFile.name}\`);
                log(\`   Size: \${reconstructedFile.size}\`);
                log(\`   Type: \${reconstructedFile.type}\`);
                log(\`   Size match: \${reconstructedFile.size === parsedFileData.size}\`);

                // Show reconstructed preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    const result = document.getElementById('result');
                    result.innerHTML += \`<h3>Reconstructed File Preview:</h3><img src="\${e.target.result}" alt="Reconstructed">\`;
                };
                reader.readAsDataURL(reconstructedFile);

            } catch (error) {
                log(\`âŒ Error reconstructing file: \${error.message}\`);
            }
        }

        async function testStep4() {
            if (!reconstructedFile) {
                log('âŒ No reconstructed file available for upload');
                return;
            }

            log('â˜ï¸ Attempting Cloudinary upload...');
            
            try {
                const formData = new FormData();
                formData.append('file', reconstructedFile);
                formData.append('upload_preset', 'studentspassport');
                formData.append('quality', 'auto');
                formData.append('fetch_format', 'auto');
                formData.append('crop', 'fill');
                formData.append('gravity', 'face');

                log('ğŸ“¤ Sending request to Cloudinary...');
                const response = await fetch('https://api.cloudinary.com/v1_1/dxkkv9nbn/image/upload', {
                    method: 'POST',
                    body: formData
                });

                log(\`ğŸ“Š Response status: \${response.status}\`);

                if (response.ok) {
                    const result = await response.json();
                    log('âœ… Upload successful!');
                    log(\`ğŸ“¸ Image URL: \${result.secure_url}\`);
                    log(\`ğŸ†” Public ID: \${result.public_id}\`);
                    log(\`ğŸ“ Dimensions: \${result.width}x\${result.height}\`);

                    // Show uploaded image
                    const resultDiv = document.getElementById('result');
                    resultDiv.innerHTML += \`<h3>Uploaded Image:</h3><img src="\${result.secure_url}" alt="Uploaded">\`;
                } else {
                    const errorText = await response.text();
                    log(\`âŒ Upload failed: \${errorText}\`);
                }

            } catch (error) {
                log(\`âŒ Upload error: \${error.message}\`);
            }
        }

        // Clear localStorage on page load for clean testing
        localStorage.removeItem('testFileData');
        log('ğŸ”§ Test environment initialized');
    </script>
</body>
</html>




























